{% extends "base.html" %}

{% block content %}
    <h1 class="text-center mb-4">To-Do List Application</h1>
    
    <!-- User ID Form -->
    {% if not user_id %}
        <div class="card mb-4">
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="user_id" class="form-label">Enter Your User ID:</label>
                        <input type="text" class="form-control" id="user_id" name="user_id" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    {% else %}
        <div class="alert alert-info">
            Welcome, {{ user_id }}! Current Date and Time: {{ current_time }}
        </div>

        <!-- Add Task Form -->
        <div class="card mb-4">
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="task_desc" class="form-label">Add New Task:</label>
                        <input type="text" class="form-control" id="task_desc" name="task_desc" required>
                    </div>
                    <button type="submit" class="btn btn-success">Add Task</button>
                </form>
            </div>
        </div>

        <!-- Task List -->
        <h3>Your Tasks</h3>
        {% if tasks|length == 0 %}
            <p class="text-muted">No tasks yet.</p>
        {% else %}
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in tasks %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ task.description }}</td>
                            <td>{{ '[Done]' if task.is_done else '[Undone]' }}</td>
                            <td>
                                <form method="POST" style="display:inline;">
                                    <input type="hidden" name="toggle_idx" value="{{ loop.index }}">
                                    <button type="submit" class="btn btn-warning btn-sm">Toggle</button>
                                </form>
                                <form method="POST" style="display:inline;">
                                    <input type="hidden" name="remove_idx" value="{{ loop.index }}">
                                    <button type="submit" class="btn btn-danger btn-sm">Remove</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
        
        <!-- Exit Button -->
        <form method="POST" action="{{ url_for('index') }}">
            <button type="submit" class="btn btn-secondary mt-3">Exit</button>
        </form>
    {% endif %}
{% endblock %}